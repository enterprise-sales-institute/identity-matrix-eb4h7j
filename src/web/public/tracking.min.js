!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("axios")):"function"==typeof define&&define.amd?define(["axios"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).MTA=t(e.axios)}(this,function(a){"use strict";/* axios v1.4.0 */
const r={PAGE_VIEW:"pageview",INTERACTION:"interaction",CONVERSION:"conversion",CUSTOM:"custom"},n={API_ENDPOINT:"https://api.mta.example.com/v1",BATCH_SIZE:10,FLUSH_INTERVAL:3e3,MAX_RETRIES:3,COMPRESSION_THRESHOLD:1e4,STORAGE_QUOTA:1e6},s=new class{constructor(){this.q=[],this.c={...n},this.s=new Map,this.f=null,this.p=!1,this.r=0,this.m=new class{constructor(){this.d=new Map}set(e,t){this.d.set(e,{v:t,t:Date.now()})}get(e){const t=this.d.get(e);return t&&Date.now()-t.t<864e5?t.v:null}clear(){this.d.clear()}},this._i()}async _i(){if(this.f=setInterval(()=>this._f(),this.c.FLUSH_INTERVAL),this.q=JSON.parse(localStorage.getItem("mta_q")||"[]"),window.MTA&&Array.isArray(window.MTA.q))for(const e of window.MTA.q)try{await this._h(e)}catch(e){console.error("MTA Queue Error:",e)}window.addEventListener("beforeunload",()=>this._f())}async track(e,t={},n={}){if(!this.s.get("consent"))throw new Error("Tracking consent required");const s={id:crypto.randomUUID(),type:e,properties:t,timestamp:Date.now(),context:{url:location.href,referrer:document.referrer,userAgent:navigator.userAgent,screen:{width:screen.width,height:screen.height},language:navigator.language}};if(location.search.substring(1).split("&").forEach(e=>{const[t,a]=e.split("=");/^utm_/.test(t)&&(s.context[t]=decodeURIComponent(a))}),JSON.stringify(s).length>this.c.COMPRESSION_THRESHOLD)try{s.compressed=!0,s.properties=btoa(JSON.stringify(s.properties))}catch(e){console.error("Compression failed:",e)}this.q.push(s),localStorage.setItem("mta_q",JSON.stringify(this.q)),this.q.length>=this.c.BATCH_SIZE&&this._f()}async _f(e={}){if(this.p||!navigator.onLine||!this.q.length)return;this.p=!0;const t=this.q.splice(0,this.c.BATCH_SIZE);try{const n=await a.post(this.c.API_ENDPOINT+"/events",{events:t},{headers:{"Content-Type":"application/json"},timeout:5e3,retries:this.c.MAX_RETRIES});200===n.status?(localStorage.setItem("mta_q",JSON.stringify(this.q)),this.r=0):this._h(t)}catch(e){if(this.r++,this.r<this.c.MAX_RETRIES)return this.q.unshift(...t),void setTimeout(()=>this._f(),1e3*Math.pow(2,this.r));console.error("Max retries reached:",e)}finally{this.p=!1}}async _h(e){Array.isArray(e)?this.q.unshift(...e):console.error("Invalid queue item:",e)}setConsent(e){this.s.set("consent",e)}configure(e){this.c={...this.c,...e}}};return window.MTA={track:s.track.bind(s),flush:s._f.bind(s),TrackingEventType:r,setConsent:s.setConsent.bind(s),configure:s.configure.bind(s),q:[]},window.MTA});